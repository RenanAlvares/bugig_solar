{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='style/menu_benef.css') }}">

<main id="benef-main">
  <div class="dashboard" id="dashboard-container">

    <!-- üîÜ Cabe√ßalho Energizado -->
    <div id="energy-header">
      <h1>Painel do Benefici√°rio</h1>
      <p>Gerencie sua conta de energia e aproveite todos os benef√≠cios dispon√≠veis.</p>
    </div>

    <!-- üí≥ Cards Principais -->
    <div class="dashboard-cards">
      
      <a href="{{ url_for('auth.get_in_queue', user_id=user_id)}}" class="card">
        <div class="card-icon"><i class="fa-solid fa-users-line"></i></div>
        <h3>Entrar na Fila</h3>
        <p>Garanta seu lugar para receber os pr√≥ximos cr√©ditos de energia.</p>
      </a>

      <a href="{{ url_for('auth.report_benef', user_id=user_id) }}" class="card">
        <div class="card-icon"><i class="fa-solid fa-chart-pie"></i></div>
        <h3>Meus Relat√≥rios</h3>
        <p>Acompanhe seu hist√≥rico de cr√©ditos e a economia gerada.</p>
      </a>

      <div>
        {% if posicao_fila %}
          <h3>Posi√ß√£o atual na fila: {{ posicao_fila }}</h3>
        {% else %}
          <h3>Voc√™ n√£o est√° na fila no momento.</h3>
          <h3>Entre na fila para consultar sua posi√ß√£o atual.</h3>
        {% endif %}
      </div>

      <!-- ‚ö° Simulador de Economia -->
      <a href="#" class="card simulador-card">
        <div class="card-icon"><i class="fa-solid fa-calculator"></i></div>
        <h3>Simulador de Economia</h3>
        <p>Calcule o quanto voc√™ pode economizar na sua conta de luz.</p>

        <div class="simulador">
          <label for="valorConta">üí∞ Valor da Conta (R$)</label>
          <input type="number" id="valorConta" placeholder="Ex: 350" min="0">

          <!-- üîò Bot√µes -->
          <div class="simulador-btns">
            <button id="calcularBtn">Calcular</button>
          </div>

          <!-- üìä Resultados -->
          <div id="resultadoSimulador" class="resultado">
            <h4>Resultados Estimados:</h4>
            <p><strong>Economia Mensal:</strong> <span id="economiaValor">‚Äî</span></p>
            <p><strong>kWh Economizados:</strong> <span id="kwhEconomia">‚Äî</span></p>
            <p><strong>CO‚ÇÇ Evitado:</strong> <span id="co2Evitado">‚Äî</span></p>
            <p><strong>Economia Anual:</strong> <span id="economiaAnual">‚Äî</span></p>
          </div>
        </div>
      </a>
      
      <a href="{{ url_for('auth.edit_user', user_id=user_id) }}" class="card">
        <div class="card-icon"><i class="fa-solid fa-user-pen"></i></div>
        <h3>Editar Perfil</h3>
        <p>Mantenha seus dados cadastrais sempre atualizados.</p>
      </a>

      <a href="#" class="card" id="card-pagamento">
          <div class="card-icon">
              <i class="fa-solid fa-users-line"></i>
              {% if pagamento_pendente %}
                  <!-- Badge de notifica√ß√£o -->
                  <span class="badge">!</span>
              {% endif %}
          </div>
          <h3>Pagamento</h3>
          <p>Realize o pagamento da transfer√™ncia para que possa receber os cr√©ditos solicitados.</p>
      </a>
      
    </div>
  </div>

  <!-- ======= Modal de Pagamento ======= -->
  <div id="modal-pagamento" class="modal">
    <div class="modal-content">
      <span class="close" id="fechar-modal">&times;</span>
      <h2>Pagamento</h2>

      {% if pagamento_pendente %}
        <p><strong>Valor:</strong> R$ {{ pagamento_pendente.valor }}</p>
        <p><strong>Vencimento:</strong> {{ pagamento_pendente.data_vencimento.strftime('%d/%m/%Y') }}</p>
      {% else %}
        <p>N√£o h√° pagamentos pendentes.</p>
      {% endif %}

      {% if pagamento_pendente %}
        <form method="POST" action="{{ url_for('auth.payment', user_id=user_id) }}">
          <label for="tipo_pagamento">Tipo de pagamento:</label>
          <select name="tipo_pagamento" id="tipo_pagamento" required>
            {% for tp in tipo_pagamento %}
              <option value="{{ tp.id }}">{{ tp.nome_tipo }}</option>
            {% endfor %}
          </select>
          <div>
            {{ form_payment.senha.label }}<br>
            {{ form_payment.senha }}
          </div>
          {{ form_payment.pagar(class="lp-button") }}
          {{ form_payment.hidden_tag() }}
        </form>
      {% endif %}
    </div>
  </div>

  <!-- Scripts -->
  <script src="{{ url_for('static', filename='js/menu_benef.js') }}"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</main>
{% endblock %}
